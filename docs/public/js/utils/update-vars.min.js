/* Update SaveData, By BlackStar, Ver.0.0.1-beta.5 */
(()=>{let h=e=>e&&"object"==typeof e&&!Array.isArray(e),c=(e,a)=>e.some(e=>a.includes(e)),u=(e,a,r=!1)=>""===e?a:r||isNaN(a)?e+"."+a:e+`[${a}]`,v=(e,a)=>[e.includes(a),e.some(e=>e.startsWith(a))],p=(e,a,t)=>{if(0===e.length)return a;if(h(e[0])&&"id"in e[0]){let r=[...e];return a.forEach(a=>{var e=r.find(e=>e.id===a.id);e?y(e,a,t):r.push(a)}),r}return Array.from(new Set([...e,...a]))},y=(s,i,n="",o)=>{if(!h(s)||!h(i))return s;let{merge_paths:d,exclude_paths:l,replacements:b}=o;Object.keys(i).forEach(e=>{var a,r,t=u(n,e);c(l,t)||(c(d,t)?Array.isArray(i[e])&&Array.isArray(s[e])?s[e]=p(s[e],i[e],t):h(i[e])?(s[e]=s[e]||{},y(s[e],i[e],t,o)):s[e]=i[e]:([a,r]=v(b,t),a?s[e]=i[e]:r?y(s,i,t,o):s.hasOwnProperty(e)||(s[e]=i[e])))})},s=(e={},a={},r={})=>{e=e??{},a=a??{};r={merge_paths:[],exclude_paths:[],replacements:[],...r};return y(e,a,"",r),e};var e=(t={})=>{Save.onLoad.add(function(e){e.state.history.forEach(r=>{var e=r.variables,a=($.wikiPassage("StoryInit"),State.variables);Object.entries(s(e,a,t)).forEach(([e,a])=>{r.variables[e]=a})})})};Macro.add("reload",{handler(){var e,a=State.variables;for(e in State.variables)State.variables.hasOwnProperty(e)&&delete State.variables[e];$.wikiPassage("StoryInit");var r=State.variables;Object.entries(s(a,r,setup.reload_rules||{})).forEach(([e,a])=>{State.variables[e]=a}),setTimeout(()=>Engine.play(passage()),Engine.DOM_DELAY)}}),setup.bindLoadMethod=e,window.bindLoadMethod=window.bindLoadMethod||e,setup.mergeObjs=s,window.mergeObjs=window.mergeObjs||s})();
/* End Update SaveData */